# $Id: Dockerfile-galera-mysql8 435 2021-10-25 23:01:20Z bpahlawa $
# $Author: bpahlawa $
# Created: 26-APR-2021
# Modified by: bpahlawa
# $Date: 2021-10-26 07:01:20 +0800 (Tue, 26 Oct 2021) $
# $Revision: 435 $
#
# Run without Rebuild
# docker run -it --name mysql8 -p 3306:3306 -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d galera-mysql8
#
# or
#
# Rebuild DBCONFIG and DATABASE
# docker run -it --name mysql8 -p 3306:3306 -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d -e MYSQL_DBCONFIG_REBUILD=yes -e MYSQL_DATABASE_REBUILD=yes galera-mysql8
#
# docker run -it --name mysql8 --network host -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d -e MYSQL_DBCONFIG_REBUILD=yes -e MYSQL_DATABASE_REBUILD=yes galera-mysql8
#
# for donor node (galera active):
# Rebuild DBCONFIG with HOST network
# docker run -it --name mysql8  --network host -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d -e GALERA_CLUSTER_BOOTSTRAP=yes -e MYSQL_DBCONFIG_REBUILD=yes galera-mysql8
#
# Run without Rebuild with HOST network
# docker run -it --name mysql8  --network host -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d galera-mysql8
#
# for joiner node:
# Rebuild DBCONFIG and DATABASE with HOST network
# docker run -it --name mysql8  --network host -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d -e MYSQL_DBCONFIG_REBUILD=yes -e MYSQL_DATABASE_REBUILD=yes -e GALERA_CLUSTER_ADDRESS="gcomm://192.168.0.178" galera-mysql8
#
# Run without Rebuild DBCONFIG and DATABASE with HOST network
# docker run -it --name mysql8  --network host -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d -e GALERA_CLUSTER_ADDRESS="gcomm://192.168.0.158" galera-mysql8
#
# Run as Master:
# docker run -it --name mysql81 -p 3306:3306 -v /opt/mysql:/var/lib/mysql -v /opt/mysql/conf:/etc/mysql/mysql.conf.d -e MYSQL_DBCONFIG_REBUILD=yes -e MYSQL_DATABASE_REBUILD=yes -e MYSQL_REPLICA_MASTER="yes" galera-mysql8
#
# Run as Slave:
# docker run -it --name mysql82 -p 3307:3306 -v /opt/mysql2:/var/lib/mysql -v /opt/mysql2/conf:/etc/mysql/mysql.conf.d -e MYSQL_DBCONFIG_REBUILD=yes -e MYSQL_REPLICA_SLAVE=yes -e MYSQL_REPLICA_MASTERIP="192.168.0.178" -e MYSQL_REPLICA_MASTERPORT=3308 galera-mysql8
#
# add Entrypoint to Dockerfile
# echo -e "&& echo \"$(cat gmysql8.env | base64 -w0)\" | base64 -d > /usr/local/bin/gmysql8.env && chmod ugo+x /usr/local/bin/gmysql8.env \\" >> Dockerfile-galera-mysql8
# echo -e "&& echo \"$(cat entrypoint-gmysql8.sh | base64 -w0)\" | base64 -d > /usr/local/bin/entrypoint-gmysql8.sh && chmod ugo+x /usr/local/bin/entrypoint-gmysql8.sh\nENTRYPOINT [\"/usr/local/bin/entrypoint-gmysql8.sh\"]" >> Dockerfile-galera-mysql8
#
# where:
# /opt/mysql (on Host)      is mapped to /var/lib/mysql (on Container)
# /opt/mysql/conf (on Host) is mapped to /etc/my.cnf.d (on Container)
# MYSQL_DBCONFIG_REBUILD=yes (re-create /etc/my.cnf.d/server.cnf
# MYSQL_DATABASE_REBUILD=yes (destroy and re-create database under directory /var/lib/mysql/data )
# --network host (it uses host network, NOTE: galera must use network host if it requires to have multimaster replication on a different node)
#
# NOTE: for all default environment variable please check galera.env file
#
# How to build this Dockerfile
# Run the following command where Dockerfile exists
#
# docker build --tag galera-mysql8 -f ./Dockerfile-galera-mysql8 /mnt

FROM debian:latest
MAINTAINER brpahlaw

WORKDIR /usr/local/bin
ENV DEBIAN_FRONTEND noninteractive
RUN apt-get update \
&& apt-get -y upgrade \
&& apt-get -y install lsb-release gnupg wget software-properties-common \
&& apt-key adv --keyserver keyserver.ubuntu.com --recv BC19DDBA \
&& echo "deb https://releases.galeracluster.com/galera-4/debian buster main" > /etc/apt/sources.list.d/galera.list \
&& echo "deb https://releases.galeracluster.com/mysql-wsrep-8.0.23-26.6/debian buster main" >> /etc/apt/sources.list.d/galera.list \
&& apt-get update \
&& apt-get -y install galera-4 galera-arbitrator-4 mysql-wsrep-8.0 busybox rsync ssh \
&& busybox --install \
&& rm -f /usr/bin/tar \
&& echo "IyEvYmluL2Jhc2gKIyAkSWQ6IGdteXNxbDguZW52IDM5OSAyMDIxLTA2LTIzIDA1OjA2OjU1WiBicGFobGF3YSAkCiMgQ3JlYXRlZCAxOS1BUFItMjAyMQojICRBdXRob3I6IGJwYWhsYXdhICQKIyAkRGF0ZTogMjAyMS0wNi0yMyAxMzowNjo1NSArMDgwMCAoV2VkLCAyMyBKdW4gMjAyMSkgJAojICRSZXZpc2lvbjogMzk5ICQKCiNiaW5sb2cgcmVwbGljYXRpb24gLyByZXBsaWNhIHNsYXZlCmV4cG9ydCBNWVNRTF9TRVJWRVJfSUQ9JHtNWVNRTF9TRVJWRVJfSUQ6LSIxIn0KZXhwb3J0IE1ZU1FMX1JFUExJQ0FfU0xBVkU9JHtNWVNRTF9SRVBMSUNBX1NMQVZFOi1ub30KZXhwb3J0IE1ZU1FMX1JFUExJQ0FfTUFTVEVSPSR7TVlTUUxfUkVQTElDQV9NQVNURVI6LW5vfQpleHBvcnQgTVlTUUxfUkVQTElDQV9NQVNURVJJUD0ke01ZU1FMX1JFUExJQ0FfTUFTVEVSSVA6LSIifQpleHBvcnQgTVlTUUxfUkVQTElDQV9NQVNURVJQT1JUPSR7TVlTUUxfUkVQTElDQV9NQVNURVJQT1JUOi0iMzMwNiJ9CmV4cG9ydCBNWVNRTF9SRVBMSUNBX01BU1RFUkxPR0ZJTEU9IiIKZXhwb3J0IE1ZU1FMX1JFUExJQ0FfTUFTVEVSTE9HUE9TVD0iIgoKZXhwb3J0IE1ZU1FMX0RBVEFCQVNFX1JFQlVJTEQ9JHtNWVNRTF9EQVRBQkFTRV9SRUJVSUxEOi1ub30KZXhwb3J0IE1ZU1FMX0RCQ09ORklHX1JFQlVJTEQ9JHtNWVNRTF9EQkNPTkZJR19SRUJVSUxEOi1ub30KZXhwb3J0IEdBTEVSQV9DTFVTVEVSX05BTUU9JHtHQUxFUkFfQ0xVU1RFUl9OQU1FOi1teWNsdXN0ZXJ9CmV4cG9ydCBHQUxFUkFfQ0xVU1RFUl9CT09UU1RSQVA9JHtHQUxFUkFfQ0xVU1RFUl9CT09UU1RSQVA6LW5vfQpleHBvcnQgR0FMRVJBX0NMVVNURVJfQUREUkVTUz0ke0dBTEVSQV9DTFVTVEVSX0FERFJFU1M6LSJnY29tbTovLyJ9CmV4cG9ydCBHQUxFUkFfQ0xVU1RFUl9BQ1RJVkU9JHtHQUxFUkFfQ0xVU1RFUl9BQ1RJVkU6LSJ5ZXMifQpleHBvcnQgR0FMRVJBX0JPT1RTVFJBUF9ESVI9IiR7TVlTUUxfQkFTRV9ESVJ9Ly5ib290c3RyYXAiCmV4cG9ydCBHQUxFUkFfQk9PVFNUUkFQX0ZJTEU9IiR7R0FMRVJBX0JPT1RTVFJBUF9ESVJ9L2RvbmUiCmV4cG9ydCBVU0VfQ09OVEFJTkVSX0FERFJFU1M9JHtVU0VfQ09OVEFJTkVSX0FERFJFU1M6LXllc30KZXhwb3J0IEdBTEVSQV9ERUZBVUxUX05PREVOQU1FPSR7R0FMRVJBX0RFRkFVTFRfTk9ERU5BTUU6LSQoaG9zdG5hbWUgLXMpfQpleHBvcnQgR0FMRVJBX0RFRkFVTFRfQUREUkVTUz0ke0dBTEVSQV9ERUZBVUxUX0FERFJFU1M6LSQoaG9zdG5hbWUgLWkgfCBhd2sgJ3twcmludCAkMX0nKX0KZXhwb3J0IE1ZU1FMX1JPT1RfUEFTU1dPUkQ9JHtNWVNRTF9ST09UX1BBU1NXT1JEOi0iRzBka24wd3MifQpleHBvcnQgTVlTUUxfREFUQUJBU0VfTkFNRT0ke01ZU1FMX0RBVEFCQVNFX05BTUU6LW15ZGJ9CmV4cG9ydCBNWVNRTF9EQVRBQkFTRV9VU0VSPSR7TVlTUUxfREFUQUJBU0VfVVNFUjotYWRtaW59CmV4cG9ydCBNWVNRTF9EQVRBQkFTRV9VU0VSUEFTUz0ke01ZU1FMX0RBVEFCQVNFX1VTRVJQQVNTOi1wYXNzd29yZH0KZXhwb3J0IE1ZU1FMX1JFUExJQ0FUSU9OX1VTRVI9JHtNWVNRTF9SRVBMSUNBVElPTl9VU0VSOi1yZXBsdXNlcn0KZXhwb3J0IE1ZU1FMX1JFUExJQ0FUSU9OX1VTRVJQQVNTPSR7TVlTUUxfUkVQTElDQVRJT05fVVNFUlBBU1M6LXBhc3N3b3JkfQpleHBvcnQgTVlTUUxfQkFTRV9ESVI9JHtNWVNRTF9CQVNFX0RJUjotL3Zhci9saWIvbXlzcWx9CmV4cG9ydCBNWVNRTF9EQVRBQkFTRV9ESVI9JHtNWVNRTF9EQVRBQkFTRV9ESVI6LSR7TVlTUUxfQkFTRV9ESVJ9L2RhdGF9CmV4cG9ydCBNWVNRTF9ERUZBVUxUX1BPUlQ9JHtNWVNRTF9ERUZBVUxUX1BPUlQ6LTMzMDZ9CmV4cG9ydCBNWVNRTF9URU1QX0RJUj0ke01ZU1FMX1RFTVBfRElSOi0ke01ZU1FMX0JBU0VfRElSfS90bXB9CmV4cG9ydCBNWVNRTF9TT0NLRVRfRklMRT0ke01ZU1FMX1NPQ0tFVF9GSUxFOi0ke01ZU1FMX1RFTVBfRElSfS9teXNxbC5zb2NrfQpleHBvcnQgTVlTUUxfUElEX0ZJTEU9JHtNWVNRTF9QSURfRklMRTotJHtNWVNRTF9URU1QX0RJUn0vbXlzcWxkLnBpZH0KZXhwb3J0IE1ZU1FMX0JJTkRfQUREUkVTUz0ke01ZU1FMX0JJTkRfQUREUkVTUzotMC4wLjAuMH0KZXhwb3J0IE1ZU1FMX0xPR1NfRElSPSR7TVlTUUxfTE9HU19ESVI6LSR7TVlTUUxfQkFTRV9ESVJ9L2xvZ3N9CmV4cG9ydCBNWVNRTF9ERUZBVUxUX0NIQVJTRVQ9JHtNWVNRTF9ERUZBVUxUX0NIQVJTRVQ6LSJ1dGY4bWI0In0KZXhwb3J0IE1ZU1FMX0RFRkFVTFRfQ09MTEFURT0ke01ZU1FMX0RFRkFVTFRfQ09MTEFURTotInV0ZjhtYjRfZ2VuZXJhbF9jaSJ9CmV4cG9ydCBNWVNRTF9QTFVHSU5fRElSPSR7TVlTUUxfUExVR0lOX0RJUjotJHtNWVNRTF9CQVNFX0RJUn0vcGx1Z2lufQpleHBvcnQgTVlTUUxfQkFDS1VQX1VTRVI9JHtNWVNRTF9CQUNLVVBfVVNFUjotImJrcHVzZXIifQpleHBvcnQgTVlTUUxfQkFDS1VQX1VTRVJQQVNTPSR7TVlTUUxfQkFDS1VQX1VTRVJQQVNTOi0icGFzc3dvcmQifQpleHBvcnQgTVlTUUxfU1NUX01FVEhPRD0ke01ZU1FMX1NTVF9NRVRIT0Q6LSJyc3luYyJ9CmV4cG9ydCBNWVNRTF9BVVRIX1BMVUdJTj0ke01ZU1FMX0FVVEhfUExVR0lOOi0ibXlzcWxfbmF0aXZlX3Bhc3N3b3JkIn0KCiNUdW5pbmcgSU5TRVJUUwpleHBvcnQgTVlTUUxfSU5OT0RCX0JVRkZFUlBPT0xfU0laRT0ke01ZU1FMX0lOTk9EQl9CVUZGRVJQT09MX1NJWkU6LSIxMEcifQpleHBvcnQgTVlTUUxfSU5OT0RCX0xPR0ZJTEVfU0laRT0ke01ZU1FMX0lOTk9EQl9MT0dGSUxFX1NJWkU6LSI1RyJ9CmV4cG9ydCBNWVNRTF9UQUJMRU9QRU5fQ0FDSEU9JHtNWVNRTF9UQUJMRU9QRU5fQ0FDSEU6LSIxMDAwIn0KZXhwb3J0IE1ZU1FMX0tFWUJVRkZFUl9TSVpFPSR7TVlTUUxfS0VZQlVGRkVSX1NJWkU6LSIxMDBNIn0KZXhwb3J0IE1ZU1FMX01BWEFMTE9XRURfUEFDS0VUPSR7TVlTUUxfTUFYQUxMT1dFRF9QQUNLRVQ6LSIyNTZNIn0KZXhwb3J0IE1ZU1FMX1JFQURCVUZGRVJfU0laRT0ke01ZU1FMX1JFQURCVUZGRVJfU0laRTotIjEwME0ifSAKCiNhY3RpdmF0ZSBQZXJmb3JtYW5jZSBzY2hlbWEKZXhwb3J0IE1ZU1FMX1BFUkZPUk1BTkNFX1NDSEVNQT0ke01ZU1FMX1BFUkZPUk1BTkNFX1NDSEVNQTo9InllcyJ9Cg==" | base64 -d > /usr/local/bin/gmysql8.env && chmod ugo+x /usr/local/bin/gmysql8.env \
&& echo "IyEvYmluL2Jhc2gKIyAkSWQ6IGVudHJ5cG9pbnQtZ215c3FsOC5zaCAzOTkgMjAyMS0wNi0yMyAwNTowNjo1NVogYnBhaGxhd2EgJAojIENyZWF0ZWQgMTktQVBSLTIwMjEKIyAkQXV0aG9yOiBicGFobGF3YSAkCiMgJERhdGU6IDIwMjEtMDYtMjMgMTM6MDY6NTUgKzA4MDAgKFdlZCwgMjMgSnVuIDIwMjEpICQKIyAkUmV2aXNpb246IDM5OSAkCgoKc291cmNlIC4vZ215c3FsOC5lbnYKCiMgVXNlciBzcGVjaWZpYyBlbnZpcm9ubWVudCBhbmQgc3RhcnR1cCBwcm9ncmFtcwpSRURGT05UPSJcZVszODs1OzE5N20iCkdSRUVORk9OVD0iXGVbMzg7NTs4Mm0iCk5PUk1BTEZPTlQ9IlxlWzBtIgpCTFVFRk9OVD0iXGVbMzg7NTsxMjNtIgpZRUxMT1dGT05UPSJcZVszODs1OzIyOW0iClZFUlNJT05fSUQ9IiIKQUxMVkVSPSIiCmV4cG9ydCBESVNUUk89IiIKUEtHRElTVFJPPSIiClJVTlBLR1VQREFURT0iMSIKTE9HRklMRT0vdG1wLyQoYmFzZW5hbWUgJDAgfCBjdXQgLWYxIC1kLikubG9nCkRCVVNFUj0ibXlzcWwiCldTUkVQTkVXQ0xVU1RFUj0iIgpBQ1RJVkFURU9OTFk9Im5vIgoKSU5JRklMRT0iL2V0Yy9teXNxbC9teXNxbC5jb25mLmQvbXlzcWxkLmNuZiIKCnRyYXAgZXhpdHNoZWxsIFNJR0lOVCBTSUdURVJNCgpkYXRlID4gJExPR0ZJTEUKCmNoZWNraW5nX3JlcWRfdG9vbHMoKQp7CiAgIHdoaWNoIC0tdmVyc2lvbiAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBbWyAkPyAtbmUgMCBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtSRURGT05UfXdoaWNoIGNvbW1hbmQgZG9lc250IGV4aXN0LCBwbGVhc2UgaW5zdGFsbCBpdC4uLiIgJiYgZXhpdAogICBzb2NhdCAtViAyPi9kZXYvbnVsbCAxPi9kZXYvbnVsbAogICBbWyAkPyAtbmUgMCBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtSRURGT05UfXNvY2F0IGNvbW1hbmQgZG9lc250IGV4aXN0LCBwbGVhc2UgaW5zdGFsbCBpdC4uLiIgJiYgZXhpdAp9CgpnZXRfYWxsX3NlY3Rpb25zKCkKewogICBzZWQgLW4gJ3MvXlsgXHRdKlxbXCguKlwpXF0uKi9cMS9wJyAiJElOSUZJTEUiCn0KCmdldF92YWx1ZSgpCnsKICAgbG9jYWwgU0VDVElPTj0iJDEiCiAgIGxvY2FsIEtFWT0iJDIiCiAgIFtbICIkS0VZIiA9ICIiIHx8ICIkU0VDVElPTiIgPSAiIiBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtSRURGT05UfVNFQ1RJT04gYW5kIEtFWSBtdXN0IGJlIHNwZWNpZmllZCEhIiAmJiByZXR1cm4KICAgc2VkIC1uICIvXlsgXHRdKlxbJFNFQ1RJT05cXS8sL1xbL3MvXlsgXHRdKiRLRVlbIFx0XSo9WyBcdF0qLy9wIiAiJElOSUZJTEUiIDI+L2Rldi9udWxsCn0KCgpydW5fY2x1c3RlcigpCnsKICAgaWYgWyAiJEdBTEVSQV9DTFVTVEVSX0JPT1RTVFJBUCIgPSAieWVzIiBdCiAgIHRoZW4KICAgICAgR0FMRVJBX0NMVVNURVJfQUREUkVTUz0iZ2NvbW06Ly8iCiAgICAgIFdTUkVQTkVXQ0xVU1RFUj0iLS13c3JlcC1uZXctY2x1c3RlciIKICAgICAgaWYgWyAtZiAkTVlTUUxfREFUQUJBU0VfRElSL2dyYXN0YXRlLmRhdCBdCiAgICAgIHRoZW4KICAgICAgICAgIHNlZCAtaSAic3xeXChzYWZlX3RvX2Jvb3RzdHJhcDouKlwpMC4qfFwxMXxnIiAiJE1ZU1FMX0RBVEFCQVNFX0RJUi9ncmFzdGF0ZS5kYXQiICAgICAgICAgCiAgICAgIGZpCiAgIGZpCn0KCgpnZXRfa2V5dmFsdWUoKQp7CiAgIGxvY2FsIFNFQ1RJT049IiQxIgogICBbWyAiJFNFQ1RJT04iID0gIiIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1TRUNUSU9OIG11c3QgYmUgc3BlY2lmaWVkISEiICYmIHJldHVybgogICBzZWQgLW4gIi9eWyBcdF0qXFskU0VDVElPTlxdLywvXFsvcy9eWyBcdF0qXChbXiM7IFx0XVteIFx0PV0qXCkuKj1bIFx0XSpcKC4qXCkvXDE9XDIvcCIgIiRJTklGSUxFIiAyPi9kZXYvbnVsbAp9CgpzZXRfdmFsdWUoKQp7CiAgIGxvY2FsIFNFQ1RJT049IiQxIgogICBsb2NhbCBLRVk9IiQyIgogICBsb2NhbCBORVdWQUw9IiQzIgogICBbWyAiJEtFWSIgPSAiIiB8fCAiJFNFQ1RJT04iID0gIiIgfHwgIiRORVdWQUwiID0gIiIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1TRUNUSU9OLCBLRVkgYW5kIE5FV1ZBTCBtdXN0IGJlIHNwZWNpZmllZCEhIiAmJiByZXR1cm4KICAgT0xES0VZVkFMPSQoZ2V0X2tleXZhbHVlICIkU0VDVElPTiIgfCBncmVwICJeJHtLRVl9W1xzXSo9LioiICkKICAgW1sgIiRPTERLRVlWQUwiID0gIiIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1TZWN0aW9uICRTRUNUSU9OIHdpdGggS2V5dmFsdWUgJE9MREtFWVZBTCBpcyBub3QgYXZhaWxhYmxlLCB0aGVyZWZvcmUgdmFsdWUgY2FuIG5vdCBiZSBjaGFuZ2VkISEiICYmIHJldHVybgogICBMTk8yUkVQTEM9JChncmVwIC1uICJeJHtLRVl9W1xzXSo9LioiICIkSU5JRklMRSIgfCBjdXQgLWYxIC1kIjoiKQogICBORVdLRVlWQUw9JCggZWNobyAiJE9MREtFWVZBTCIgfCBzZWQgInMvXCheJEtFWS4qPVwpLiovXDEkTkVXVkFMLyIpCiAgIGlmIFtbICIkT0xES0VZVkFMIiAhPSAiIiAmJiAiJE5FV0tFWVZBTCIgIT0gIiIgXV0KICAgdGhlbgogICAgICBzZWQgLWkgIiR7TE5PMlJFUExDfXMvLiovJE5FV0tFWVZBTC8iICIkSU5JRklMRSIKICAgICAgW1sgJD8gLWVxIDAgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfVNlY3Rpb24gJFNFQ1RJT04gbGluZSAkT0xES0VZVkFMIGF0IGxpbmUjICRMTk8yUkVQTEMgaGFzIGJlZW4gcmVwbGFjZWQgd2l0aCAkTkVXS0VZVkFMIgogICBlbHNlCiAgICAgIGRpc3BsYXlfb3V0cHV0ICIke1JFREZPTlR9ZWl0aGVyIG9sZCBrZXl2YWx1ZSBvciBuZXcga2V5dmFsdWUgaXMgZW1wdHkhIVxub2xkIGtleXZhbHVlID0gJE9MREtFWVZBTCBcbm5ldyBrZXl2YWx1ZSA9ICRORVdLRVlWQUwiCiAgIGZpCn0KCmFkZF9rZXl2YWx1ZSgpCnsKICBsb2NhbCBTRUNUSU9OPSIkMSIKICBsb2NhbCBLRVlWQUw9IiQyIgogIGxvY2FsIEFGVEVSS0VZPSIkMyIKICBbWyAiJFNFQ1RJT04iID0gIiIgfHwgIiRLRVlWQUwiID0gIiIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1TRUNUSU9OIGFuZCBuZXcgS2V5dmFsdWUgbXVzdCBiZSBzcGVjaWZpZWQhISIgJiYgcmV0dXJuCiAgTE5PU0VDVElPTj0kKGdyZXAgLW4gIl5cWyR7U0VDVElPTn1cXS4qIiAiJElOSUZJTEUiIHwgY3V0IC1mMSAtZCI6IikKICBpZiBbICIkQUZURVJLRVkiICE9ICIiIF0KICB0aGVuCiAgICAgTE5PMk1BUks9JChncmVwIC1uICJeJHtBRlRFUktFWX1bXHNdKj0uKiIgIiRJTklGSUxFIiB8IGN1dCAtZjEgLWQiOiIpCiAgZWxzZQogICAgIExOTzJNQVJLPSIkTE5PU0VDVElPTiIKICBmaQogIFtbICRMTk8yTUFSSyAtbHQgJExOT1NFQ1RJT04gJiYgJExOTzJNQVJLIC1sdCAxIF1dICYmIGRpc3BsYXlfb3V0cHV0ICIke1JFREZPTlR9VGhlcmUgYXJlIGR1cGxpY2F0ZSBrZXlzLi4iICYmIHJldHVybgogIHNlZCAtaSAiJExOTzJNQVJLIGEgJEtFWVZBTCIgIiRJTklGSUxFIgogIFtbICQ/IC1lcSAwIF1dICYmIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1LZXl2YWx1ZSAkS0VZVkFMIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBhZGRlZCBpbnRvIFNlY3Rpb24gJFNFQ1RJT04gYXQgbGluZSMgJCgoIExOTzJNQVJLICsgMSApKSIKfQoKCmV4aXRzaGVsbCgpCnsKICAgZGlzcGxheV9vdXRwdXQgIiR7Tk9STUFMRk9OVH1DYW5jZWxsaW5nIHNjcmlwdC4uLi5leGl0aW5nLi4uLi4iCiAgIFtbICEgLWQgIiRNWVNRTF9EQVRBQkFTRV9ESVIvbXlzcWwiICYmIC1kICRNWVNRTF9EQVRBQkFTRV9ESVIgJiYgIiRNWVNRTF9EQVRBQkFTRV9ESVIiICE9ICIvIiBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9UmVtb3ZpbmcgZGlyZWN0b3J5ICRNWVNRTF9EQVRBQkFTRV9ESVIiICYmIHJtIC1yZiAkTVlTUUxfREFUQUJBU0VfRElSCiAgIFtbIC1mICRNWVNRTF9MT0dTX0RJUi9teXNxbGQubG9nIF1dICYmIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1SZW1vdmluZyBNeVNRTCBsb2cgZmlsZSAkTVlTUUxfTE9HU19ESVIvbXlzcWxkLmxvZyIgJiYgcm0gLWYgJE1ZU1FMX0xPR1NfRElSL215c3FsZC5sb2cKICAgZXhpdCAwCn0KCgpkaXNwbGF5X291dHB1dCgpCnsKICAgbG9jYWwgTUVTU0FHRT0iJDEiCiAgIGxvY2FsIEhJREU9IiQyIgoKICAgW1sgIiRISURFIiA9ICIxIiB8fCAiJEhJREUiID0gIiIgXV0gJiYgZWNobyAtZSAiJE1FU1NBR0Uke05PUk1BTEZPTlR9IgogICBbWyAiJEhJREUiID0gIjIiIHx8ICIkSElERSIgPSAiIiBdXSAmJiBlY2hvIC1lICIkTUVTU0FHRSIgfCBzZWQgLXIgInMvW1s6Y250cmw6XV1cWyhbMC05XXsxLDN9OykqWzAtOV17MSwzfW0vL2ciID4+ICRMT0dGSUxFCn0KCgpydW5fbXlzcWxfY21kKCkKewogIFRIRUNNRD0iJDEiCiAgSE9TVElQPSIkMiIKICBIT1NUUE9SVD0iJDMiCiAgVVNFUk5BTUU9IiQ0IgogIFBBU1NXT1JEPSIkNSIKICBSQVdPVVRQVVQ9IiQ2IgoKICBpZiBbICIkSE9TVElQIiA9ICIiIF0KICB0aGVuCiAgICAgIGlmIFsgIiRSQVdPVVRQVVQiID0gInllcyIgXQogICAgICB0aGVuCiAgICAgICAgIGlmIFsgIiRVU0VSTkFNRSIgPSAiIiBdCiAgICAgICAgIHRoZW4KICAgICAgICAgICAgbXlzcWwgLXUgcm9vdCAtc04gLWUgIiRUSEVDTUQiCiAgICAgICAgIGVsc2UKICAgICAgICAgICAgZXhwb3J0IE1ZU1FMX1BXRD0iJFBBU1NXT1JEIgogICAgICAgICAgICBteXNxbCAtdSAiJFVTRVJOQU1FIiAtc04gLWUgIiRUSEVDTUQiCiAgICAgICAgICAgIHVuc2V0IE1ZU1FMX1BXRAogICAgICAgICBmaQogICAgICBlbHNlCiAgICAgICAgIGlmIFsgIiRVU0VSTkFNRSIgPSAiIiBdCiAgICAgICAgIHRoZW4KICAgICAgICAgICAgbXlzcWwgLXUgcm9vdCAtZSAiJFRIRUNNRCIKICAgICAgICAgZWxzZQogICAgICAgICAgICBleHBvcnQgTVlTUUxfUFdEPSIkUEFTU1dPUkQiCiAgICAgICAgICAgIG15c3FsIC11ICIkVVNFUk5BTUUiIC1lICIkVEhFQ01EIgogICAgICAgICAgICB1bnNldCBNWVNRTF9QV0QKICAgICAgICAgZmkKICAgICAgZmkKICBlbHNlCiAgICAgIGV4cG9ydCBNWVNRTF9QV0Q9IiRQQVNTV09SRCIKICAgICAgW1sgIiRIT1NUUE9SVCIgPSAiIiB8fCAiJFVTRVJOQU1FIiA9ICIiIHx8ICIkUEFTU1dPUkQiID0gIiIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1NYXN0ZXIgSVAsIFBvcnQsIFVzZXJuYW1lIGFuZCBwYXNzd29yZCBtdXN0IGJlIHNwZWNpZmllZCEhIiAmJiBleGl0IDEKICAgICAgaWYgWyAiJFJBV09VVFBVVCIgPSAieWVzIiBdCiAgICAgIHRoZW4KICAgICAgICAgbXlzcWwgLXUgIiRVU0VSTkFNRSIgLWggIiRIT1NUSVAiIC1QICIkSE9TVFBPUlQiIC1zTiAtZSAiJFRIRUNNRCIKICAgICAgZWxzZQogICAgICAgICBteXNxbCAtdSAiJFVTRVJOQU1FIiAtaCAiJEhPU1RJUCIgLVAgIiRIT1NUUE9SVCIgLWUgIiRUSEVDTUQiCiAgICAgIGZpCiAgICAgIHVuc2V0IE1ZU1FMX1BXRAogIGZpCgogIGlmIFsgIiRSQVdPVVRQVVQiICE9ICJ5ZXMiIF0KICB0aGVuCiAgICAgaWYgWyAkPyAtbmUgMCBdCiAgICAgdGhlbgogICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke1JFREZPTlR9RmFpbGVkIHRvIGV4ZWN1dGUgdGhlIGxhc3QgU3RhdGVtZW50ISEiCiAgICAgZWxzZQogICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0JMVUVGT05UfVN0YXRlbWVudCBleGVjdXRlZCBzdWNjZXNzZnVsbHkiCiAgICAgZmkKICBmaQogICAgICAgICAKfQoKZ2V0X3BpZCgpIHsKICAgIGxvY2FsIFBJREZJTEU9IiR7MTo/cGlkIGZpbGUgaXMgbWlzc2luZ30iCgogICAgaWYgW1sgLWYgIiRQSURGSUxFIiBdXTsgdGhlbgogICAgICAgIGlmIFtbIC1uICIkKDwgIiRQSURGSUxFIikiIF1dICYmIFtbICIkKDwgIiRQSURGSUxFIikiIC1ndCAwIF1dOyB0aGVuCiAgICAgICAgICAgIGVjaG8gIiQoPCAiJFBJREZJTEUiKSIKICAgICAgICBmaQogICAgZmkKfQoKaXNfZGJfcnVubmluZygpIHsKICAgIGxvY2FsIFBJRD0iJHsxOj9waWQgaXMgbWlzc2luZ30iCiAgICBraWxsIC0wICIkUElEIiAyPi9kZXYvbnVsbAogICAgZWNobyAkPwp9CgoKaXNfbXlzcWxfcnVubmluZygpCnsKICAgIGxvY2FsIFBJRAogICAgUElEPSIkKGdldF9waWQgIiRNWVNRTF9QSURfRklMRSIpIgogICAgaWYgW1sgLXogIiRQSUQiIF1dOyB0aGVuCiAgICAgICBlY2hvIDEgCiAgICBlbHNlCiAgICAgICAgZWNobyAkKGlzX2RiX3J1bm5pbmcgIiRQSUQiKQogICAgZmkKfQoKCmlzX215c3FsX2FjY2Vzc2libGUoKQp7CiAgIG15c3FsIC11IHJvb3QgPDwhIDI+L2Rldi9udWxsCnNlbGVjdCB1c2VyKCk7CiEKCltbICQ/IC1uZSAwIF1dICYmIGVjaG8gIk5PVCBSVU5OSU5HIgp9CgoKaW5pdF9teXNxbF9kYXRhYmFzZSgpCnsKICAgIGxvY2FsIC1hIEZMQUdTPSgiLS11c2VyPSREQlVTRVIiICItLWJpbmQtYWRkcmVzcz0xMjcuMC4wLjEiICItLWluaXRpYWxpemUtaW5zZWN1cmUiKQogICAgRkxBR1MrPSgiJEAiKQogICAgW1sgLWQgJE1ZU1FMX0RBVEFCQVNFX0RJUiBdXSAmJiBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9UmVtb3ZpbmcgYWxsIGZpbGVzIHVuZGVyIGRhdGFiYXNlIGRpcmVjdG9yeSAkTVlTUUxfREFUQUJBU0VfRElSIC4uIiAmJiBybSAtcmYgJE1ZU1FMX0RBVEFCQVNFX0RJUi8qCiAgICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9SW5pdGlhbGl6aW5nIERhdGFiYXNlLi4uIgogICAgbXlzcWxkICIke0ZMQUdTW0BdfSIKfQoKcnVuX215c3FsX3RlbXBfYmcoKQp7CiAgICBsb2NhbCAtYSBGTEFHUz0oIi0tdXNlcj0kREJVU0VSIiAiLS1iaW5kLWFkZHJlc3M9MTI3LjAuMC4xIiAiLS1za2lwLXNsYXZlLXN0YXJ0IikKICAgIEZMQUdTKz0oIiRAIikKICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1TdGFydGluZyBNeVNRTCBpbiBiYWNrZ3JvdW5kIgogICAgbXlzcWxkICIke0ZMQUdTW0BdfSIgJgp9CgpyZXNldF9yb290X3Bhc3N3b3JkKCkKewogICAgbG9jYWwgVE1QUk9PVFBBU1NXT1JEPSIkMSIKICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1SZXNldHRpbmcgcm9vdCBwYXNzd29yZC4uLiIKICAgIG15c3FsIC0tY29ubmVjdC1leHBpcmVkLXBhc3N3b3JkIC11IHJvb3QgPDwhCmFsdGVyIHVzZXIgJ3Jvb3QnQCdsb2NhbGhvc3QnIGlkZW50aWZpZWQgd2l0aCBteXNxbF9uYXRpdmVfcGFzc3dvcmQgYnkgIiRNWVNRTF9ST09UX1BBU1NXT1JEIjsKRkxVU0ggUFJJVklMRUdFUzsKIQoKW1sgJD8gLWVxIDAgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfXJvb3QgcGFzc3dvcmQgaGFzIGJlZW4gcmVzZXR0ZWQgc3VjY2Vzc2Z1bGx5IiB8fCBkaXNwbGF5X291dHB1dCAiJHtSRURGT05UfVVuYWJsZSB0byByZXNldCByb290IHBhc3N3b3JkISEuLiIKCn0KCgpjcmVhdGVfZGJfYW5kX3VzZXIoKQp7CiAgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfUNyZWF0aW5nIERhdGFiYXNlICR7QkxVRUZPTlR9JE1ZU1FMX0RBVEFCQVNFX05BTUUiCiAgcnVuX215c3FsX2NtZCAiY3JlYXRlIGRhdGFiYXNlICRNWVNRTF9EQVRBQkFTRV9OQU1FIDsiIAogIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1DcmVhdGluZyBEQkEgdXNlciAke0JMVUVGT05UfSRNWVNRTF9EQVRBQkFTRV9VU0VSJHtHUkVFTkZPTlR9IGZvciBkYXRhYmFzZSAke0JMVUVGT05UfSRNWVNRTF9EQVRBQkFTRV9OQU1FIgogIHJ1bl9teXNxbF9jbWQgImNyZWF0ZSB1c2VyIGlmIG5vdCBleGlzdHMgJHtNWVNRTF9EQVRBQkFTRV9VU0VSfUAnJScgSURFTlRJRklFRCBCWSAnJE1ZU1FMX0RBVEFCQVNFX1VTRVJQQVNTJzsiCiAgcnVuX215c3FsX2NtZCAiZ3JhbnQgYWxsIG9uICR7TVlTUUxfREFUQUJBU0VfTkFNRX0uKiB0byAnJHtNWVNRTF9EQVRBQkFTRV9VU0VSfSdAJyUnOyIKfQoKY3JlYXRlX3JlcGxfdXNlcigpCnsKICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9Q3JlYXRpbmcgUmVwbGljYXRpb24gdXNlciAke0JMVUVGT05UfSRNWVNRTF9SRVBMSUNBVElPTl9VU0VSIgogIHJ1bl9teXNxbF9jbWQgImNyZWF0ZSB1c2VyIGlmIG5vdCBleGlzdHMgJHtNWVNRTF9SRVBMSUNBVElPTl9VU0VSfUAnJScgSURFTlRJRklFRCBCWSAnJE1ZU1FMX1JFUExJQ0FUSU9OX1VTRVJQQVNTJzsiCiAgcnVuX215c3FsX2NtZCAiZ3JhbnQgUkVQTElDQVRJT04gQ0xJRU5UIE9OICouKiB0byAkTVlTUUxfUkVQTElDQVRJT05fVVNFUkAnJSc7CmdyYW50IFBST0NFU1MgT04gKi4qIHRvICRNWVNRTF9SRVBMSUNBVElPTl9VU0VSQCclJzsKZ3JhbnQgUkVQTElDQVRJT04gU0xBVkUgT04gKi4qIHRvICRNWVNRTF9SRVBMSUNBVElPTl9VU0VSQCclJzsKZmx1c2ggcHJpdmlsZWdlczsiCgp9CgpjcmVhdGVfYmFja3VwX3VzZXIoKQp7CiAgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfUNyZWF0aW5nIEJhY2t1cCB1c2VyICR7QkxVRUZPTlR9JE1ZU1FMX0JBQ0tVUF9VU0VSIgogIHJ1bl9teXNxbF9jbWQgImNyZWF0ZSB1c2VyIGlmIG5vdCBleGlzdHMgJHtNWVNRTF9CQUNLVVBfVVNFUn1AJyUnIElERU5USUZJRUQgQlkgJyRNWVNRTF9CQUNLVVBfVVNFUlBBU1MnOyIKICBydW5fbXlzcWxfY21kICJncmFudCBSRUxPQUQsUFJPQ0VTUyxMT0NLIFRBQkxFUyxSRVBMSUNBVElPTiBDTElFTlQgb24gKi4qIHRvICRNWVNRTF9CQUNLVVBfVVNFUkAnJSc7CkdSQU5UIEJBQ0tVUF9BRE1JTiwgUFJPQ0VTUywgUkVMT0FELCBMT0NLIFRBQkxFUywgUkVQTElDQVRJT04gQ0xJRU5UIE9OICouKiB0byAkTVlTUUxfQkFDS1VQX1VTRVJAJyUnOwpHUkFOVCBTRUxFQ1QgT04gcGVyZm9ybWFuY2Vfc2NoZW1hLmxvZ19zdGF0dXMgVE8gJE1ZU1FMX0JBQ0tVUF9VU0VSQCclJzsKZmx1c2ggcHJpdmlsZWdlczsiCgp9CgoKY3JlYXRlX2RlZmF1bHRfcGFyYW1ldGVycygpCnsKW1sgISAtZCAiJE1ZU1FMX0JBU0VfRElSIiBdXSAmJiBta2RpciAtcCAiJE1ZU1FMX0JBU0VfRElSIgpjaG93biAtUmggJERCVVNFUjokREJVU0VSICIkTVlTUUxfQkFTRV9ESVIiCgpbWyAhIC1kICIkTVlTUUxfVEVNUF9ESVIiIF1dICYmIHN1IC0gJERCVVNFUiAtcyAvYmluL2Jhc2ggLWMgIm1rZGlyIFwiJE1ZU1FMX1RFTVBfRElSXCIiCltbICEgLWQgIiRNWVNRTF9MT0dTX0RJUiIgXV0gJiYgc3UgLSAkREJVU0VSIC1zIC9iaW4vYmFzaCAtYyAibWtkaXIgXCIkTVlTUUxfTE9HU19ESVJcIiIKCmlmIFsgIiR7R0FMRVJBX0NMVVNURVJfQUNUSVZFfSIgPSAieWVzIiBdCnRoZW4KICAgaWYgWyAiJHtHQUxFUkFfQ0xVU1RFUl9BRERSRVNTfSIgPSAiZ2NvbW06Ly8iIF0KICAgdGhlbgogICAgICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9UnVubmluZyBEb25vciBub2RlIG9uIGdhbGVyYSBDbHVzdGVyICRHQUxFUkFfQ0xVU1RFUl9OQU1FIC4uLiIKICAgZWxzZQogICAgICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9UnVubmluZyBKb2luZXIgbm9kZSBvbiBnYWxlcmEgQ2x1c3RlciAkR0FMRVJBX0NMVVNURVJfTkFNRSAuLi4iCiAgIGZpICAgIAplbHNlCiAgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfVJ1bm5pbmcgc2luZ2xlIG5vZGUgTXlTUUwgU2VydmVyLi4uIgpmaQoKaWYgWyAtZiAvZXRjL215LmNuZi5kLy5sb2NhbGRpciBdCnRoZW4KICAgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1UaGUgZGlyZWN0b3J5IC9ldGMvbXkuY25mLmQgaXMgbm90IG1hcHBlZCB0byBwZXJzaXN0ZW50IGRpc2siCiAgIGV4aXQgMQpmaQoKW1sgLWYgJElOSUZJTEUgJiYgIiRNWVNRTF9EQkNPTkZJR19SRUJVSUxEIiA9ICJubyIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7QkxVRUZPTlR9VGhlICRJTklGSUxFIGFscmVhZHkgZXhpc3RzISEuLi4iICYmIHJldHVybgoKW1sgIiRHQUxFUkFfQ0xVU1RFUl9BQ1RJVkUiID0gInllcyIgXV0gJiYgV1NSRVBfT049IndzcmVwX29uID0gb24iIHx8IFdTUkVQX09OPSIiCgppZiBbICIkTVlTUUxfUEVSRk9STUFOQ0VfU0NIRU1BIiA9ICJ5ZXMiIF0KdGhlbgogICBQRVJGT1JNQU5DRV9TQ0hFTUE9InBlcmZvcm1hbmNlX3NjaGVtYT1PTgpwZXJmb3JtYW5jZS1zY2hlbWEtaW5zdHJ1bWVudD0nc3RhZ2UvJT1PTicKcGVyZm9ybWFuY2Utc2NoZW1hLWNvbnN1bWVyLWV2ZW50cy1zdGFnZXMtY3VycmVudD1PTgpwZXJmb3JtYW5jZS1zY2hlbWEtY29uc3VtZXItZXZlbnRzLXN0YWdlcy1oaXN0b3J5PU9OCnBlcmZvcm1hbmNlLXNjaGVtYS1jb25zdW1lci1ldmVudHMtc3RhZ2VzLWhpc3RvcnktbG9uZz1PTiIKZmkKCltbICIkTVlTUUxfUkVQTElDQV9NQVNURVIiID0gInllcyIgfHwgIiRNWVNRTF9SRVBMSUNBX1NMQVZFIiA9ICJ5ZXMiIF1dICYmIE1ZU1FMTUFTVEVSPSJzZXJ2ZXItaWQ9JHtNWVNRTF9TRVJWRVJfSUR9IgoKZWNobyAtZSAiCltteXNxbGRdCiRNWVNRTE1BU1RFUgpkZWZhdWx0X2F1dGhlbnRpY2F0aW9uX3BsdWdpbj0ke01ZU1FMX0FVVEhfUExVR0lOfQpza2lwX2hvc3RfY2FjaGUKc2tpcF9uYW1lX3Jlc29sdmUKZXhwbGljaXRfZGVmYXVsdHNfZm9yX3RpbWVzdGFtcApiYXNlZGlyPS91c3IKZGF0YWRpcj0ke01ZU1FMX0RBVEFCQVNFX0RJUn0KcG9ydD0ke01ZU1FMX0RFRkFVTFRfUE9SVH0KdG1wZGlyPSR7TVlTUUxfVEVNUF9ESVJ9CnNvY2tldD0ke01ZU1FMX1NPQ0tFVF9GSUxFfQpwaWRfZmlsZT0ke01ZU1FMX1BJRF9GSUxFfQptYXhfYWxsb3dlZF9wYWNrZXQ9MTZNCmJpbmRfYWRkcmVzcz0ke01ZU1FMX0JJTkRfQUREUkVTU30KbG9nX2Vycm9yPSR7TVlTUUxfTE9HU19ESVJ9L215c3FsZC5sb2cKY2hhcmFjdGVyX3NldF9zZXJ2ZXI9JHtNWVNRTF9ERUZBVUxUX0NIQVJTRVR9CmNvbGxhdGlvbl9zZXJ2ZXI9JHtNWVNRTF9ERUZBVUxUX0NPTExBVEV9CmJpbmxvZ19mb3JtYXQ9cm93CmxvZ19iaW49bXlzcWwtYmluCmlubm9kYl9idWZmZXJfcG9vbF9zaXplPSR7TVlTUUxfSU5OT0RCX0JVRkZFUlBPT0xfU0laRX0KaW5ub2RiX2xvZ19maWxlX3NpemU9JHtNWVNRTF9JTk5PREJfTE9HRklMRV9TSVpFfQp0YWJsZV9vcGVuX2NhY2hlPSR7TVlTUUxfVEFCTEVPUEVOX0NBQ0hFfQprZXlfYnVmZmVyX3NpemU9JHtNWVNRTF9LRVlCVUZGRVJfU0laRX0KbWF4X2FsbG93ZWRfcGFja2V0PSR7TVlTUUxfTUFYQUxMT1dFRF9QQUNLRVR9CnJlYWRfYnVmZmVyX3NpemU9JHtNWVNRTF9SRUFEQlVGRkVSX1NJWkV9CgoKJFdTUkVQX09OCndzcmVwX3Byb3ZpZGVyPS91c3IvbGliL2xpYmdhbGVyYV9zbW0uc28Kd3NyZXBfc3N0X21ldGhvZD0ke01ZU1FMX1NTVF9NRVRIT0R9CndzcmVwX3NsYXZlX3RocmVhZHM9NAp3c3JlcF9jbHVzdGVyX2FkZHJlc3M9JHtHQUxFUkFfQ0xVU1RFUl9BRERSRVNTfQp3c3JlcF9zc3RfYXV0aD0ke01ZU1FMX0JBQ0tVUF9VU0VSfToke01ZU1FMX0JBQ0tVUF9VU0VSUEFTU30Kd3NyZXBfY2x1c3Rlcl9uYW1lPSR7R0FMRVJBX0NMVVNURVJfTkFNRX0Kd3NyZXBfbm9kZV9uYW1lPSR7R0FMRVJBX0RFRkFVTFRfTk9ERU5BTUV9CndzcmVwX25vZGVfYWRkcmVzcz0ke0dBTEVSQV9ERUZBVUxUX0FERFJFU1N9CiRQRVJGT1JNQU5DRV9TQ0hFTUEKCltjbGllbnRdCnBvcnQ9JHtNWVNRTF9ERUZBVUxUX1BPUlR9CnNvY2tldD0ke01ZU1FMX1NPQ0tFVF9GSUxFfQpkZWZhdWx0X2NoYXJhY3Rlcl9zZXQ9JHtNWVNRTF9ERUZBVUxUX0NIQVJTRVR9CgpbbWFuYWdlcl0KcG9ydD0ke01ZU1FMX0RFRkFVTFRfUE9SVH0Kc29ja2V0PSR7TVlTUUxfU09DS0VUX0ZJTEV9CnBpZF9maWxlPSR7TVlTUUxfUElEX0ZJTEV9CgoKW215c3FsXQoiID4gJElOSUZJTEUKfQoKCnNodXRkb3duX3RtcF9teXNxbCgpCnsKICAgbXlzcWxhZG1pbiAtdSByb290IHNodXRkb3duCiAgIHdoaWxlIFtbICQoaXNfbXlzcWxfcnVubmluZykgLWVxIDAgXV0KICAgZG8KICAgICAgc2xlZXAgMwogICBkb25lCn0KCmFjdGl2YXRlX3NsYXZlKCkKewogIE1BU1RFUlNUQVRVUz0kKHJ1bl9teXNxbF9jbWQgInNob3cgbWFzdGVyIHN0YXR1czsiICIkTVlTUUxfUkVQTElDQV9NQVNURVJJUCIgIiRNWVNRTF9SRVBMSUNBX01BU1RFUlBPUlQiICIkTVlTUUxfUkVQTElDQVRJT05fVVNFUiIgIiRNWVNRTF9SRVBMSUNBVElPTl9VU0VSUEFTUyIgInllcyIpCiAgTUFTVEVSTE9HRklMRT0kKGVjaG8gJE1BU1RFUlNUQVRVUyB8IGF3ayAne3ByaW50ICQxJ30pCiAgTUFTVEVSTE9HUE9TPSQoZWNobyAkTUFTVEVSU1RBVFVTIHwgYXdrICd7cHJpbnQgJDInfSkKICBTUUxDTUQ9IkNIQU5HRSBSRVBMSUNBVElPTiBTT1VSQ0UgVE8gU09VUkNFX0hPU1Q9JyRNWVNRTF9SRVBMSUNBX01BU1RFUklQJyxTT1VSQ0VfUE9SVD0kTVlTUUxfUkVQTElDQV9NQVNURVJQT1JULApTT1VSQ0VfVVNFUj0nJE1ZU1FMX1JFUExJQ0FUSU9OX1VTRVInLFNPVVJDRV9QQVNTV09SRD0nJE1ZU1FMX1JFUExJQ0FUSU9OX1VTRVJQQVNTJyxTT1VSQ0VfTE9HX0ZJTEU9JyRNQVNURVJMT0dGSUxFJyxTT1VSQ0VfTE9HX1BPUz0kTUFTVEVSTE9HUE9TOyIKCiAgaWYgWyAiJEFDVElWQVRFT05MWSIgPSAieWVzIiBdCiAgdGhlbgogICAgIHJ1bl9teXNxbF9jbWQgInN0b3Agc2xhdmU7JFNRTENNRCBzdGFydCBzbGF2ZTsiCiAgZWxzZQogICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1FbnN1cmUgdGhlIHJlcGxpY2EgZGF0YWJhc2UgaGFzIGJlZW4gc3luY2VkIHRvIG1hc3Rlciwgc28gdGhlIGRhdGEgYmV0d2VlbiBtYXN0ZXIgYW5kIHJlcGxpY2EgYXJlIHRoZSBzYW1lIgogICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1pZiBpdCBpcyBub3QgdGhlbiByZS1ydW4gXCJDSEFOR0UgUkVQTElDQVRJT04gU09VUkNFIFRPIC4uLlwiIGNvbW1hbmQgb25jZSB0aGUgZGF0YSBiZXR3ZWVuIG1hc3RlciBhbmQgc2xhdmUgaGF2ZSBiZWVuIHN5bmNlZCIKICAgICBydW5fbXlzcWxfY21kICIkU1FMQ01EIgogICAgIHJ1bl9teXNxbF9jbWQgInN0YXJ0IHNsYXZlOyIKICAgICBzaHV0ZG93bl90bXBfbXlzcWwKICAgICBteXNxbGQgLS11c2VyICREQlVTRVIgLS1sb2ctZXJyb3ItdmVyYm9zaXR5PTMgICAgICAKICBmaQp9CgoKcnVuX3NsYXZlKCkKewogIGlmIFsgIiRNWVNRTF9SRVBMSUNBX01BU1RFUiIgID0gInllcyIgXQogIHRoZW4KICAgICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9UnVubmluZyBEYXRhYmFzZSAke0JMVUVGT05UfSRNWVNRTF9EQVRBQkFTRV9OQU1FIGFzIG1hc3RlciIKICBlbGlmIFsgIiRNWVNRTF9SRVBMSUNBX1NMQVZFIiA9ICJ5ZXMiIF0KICB0aGVuCiAgICAgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfVRyeWluZyB0byBydW4gRGF0YWJhc2UgJHtCTFVFRk9OVH0kTVlTUUxfREFUQUJBU0VfTkFNRSBhcyBzbGF2ZSIKICAgICBbWyAiJE1ZU1FMX1JFUExJQ0FfTUFTVEVSSVAiID0gIiIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1EYXRhYmFzZSBNYXN0ZXIgSVAgbXVzdCBiZSBzcGVjaWZpZWQhIS4uZXhpdGluZyIgJiYgZXhpdCAxCiAgICAgZXhwb3J0IE1ZU1FMX1JFUExJQ0FfTUFTVEVSTE9HRklMRT0iIgogICAgIGV4cG9ydCBNWVNRTF9SRVBMSUNBX01BU1RFUkxPR1BPU1Q9IiIKICAgICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9R2F0aGVyaW5nIHNlcnZlci1pZCBmcm9tIG1hc3RlciBkYXRhYmFzZS4uLi4iCiAgICAgTUFTVEVSU0VSVkVSSUQ9JChydW5fbXlzcWxfY21kICJzaG93IHZhcmlhYmxlcyBsaWtlICdzZXJ2ZXJfaWQnOyIgIiRNWVNRTF9SRVBMSUNBX01BU1RFUklQIiAiJE1ZU1FMX1JFUExJQ0FfTUFTVEVSUE9SVCIgIiRNWVNRTF9SRVBMSUNBVElPTl9VU0VSIiAiJE1ZU1FMX1JFUExJQ0FUSU9OX1VTRVJQQVNTIiAieWVzIiAyPi9kZXYvbnVsbHwgYXdrICd7cHJpbnQgJDJ9JykKICAgICBbWyAiJE1BU1RFUlNFUlZFUklEIiA9ICIiIF1dICYmICIke1JFREZPTlR9TWFzdGVyIFNlcnZlciBJUDogJE1ZU1FMX1JFUExJQ0FfTUFTVEVSSVA6JE1ZU1FMX1JFUExJQ0FfTUFTVEVSUE9SVCBzZXJ2ZXItaWQgd2FzIG5vdCBzZXQuLi5QbGVhc2Ugc2V0IHNlcnZlci1pZC4uLiBleGl0aW5nIiAmJiBleGl0IDEKICAgICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9R2F0aGVyaW5nIHNlcnZlci1pZCBmcm9tIHNsYXZlIGRhdGFiYXNlIGNvbmZpZyBmaWxlLi4uLiIKICAgICBTTEFWRVNFUlZFUklEPSQoZ2V0X3ZhbHVlICJteXNxbGQiICJzZXJ2ZXItaWQiKQogICAgIFtbICIkU0xBVkVTRVJWRVJJRCIgPSAiIiBdXSAmJiBTTEFWRVNFUlZFUklEPSIkTVlTUUxfU0VSVkVSX0lEIgogICAgIGlmIFsgIiRNQVNURVJTRVJWRVJJRCIgPSAiJE1ZU1FMX1NFUlZFUl9JRCIgXQogICAgIHRoZW4KICAgICAgICBbWyAkKGlzX215c3FsX3J1bm5pbmcpIC1lcSAwIF1dICYmIHNodXRkb3duX3RtcF9teXNxbAogICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1QYXJhbWV0ZXIgTVlTUUxfU0VSVkVSX0lEPSRNWVNRTF9TRVJWRVJfSUQgd2hpbGUgbWFzdGVyIHNlcnZlcl9pZD0kTUFTVEVSU0VSVkVSSUQgLi4uIgogICAgICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1TbGF2ZSBzZXJ2ZXJfaWQgZnJvbSBjb25maWcgZmlsZSBpcyAkU0xBVkVTRVJWRVJJRCAuLi4uIgogICAgICAgIFtbICIkTUFTVEVSU0VSVkVSSUQiID0gIiRTTEFWRVNFUlZFUklEIiBdXSAmJiBTTEFWRVNFUlZFUklEPSQoKCBNWVNRTF9TRVJWRVJfSUQgKyAxICkpICYmIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1TZXR0aW5nIHNsYXZlIHNlcnZlcl9pZCB0byAkU0xBVkVTRVJWRVJJRCAuLi4uIgogICAgICAgIGlmIFsgIiRNQVNURVJTRVJWRVJJRCIgPSAiJE1ZU1FMX1NFUlZFUl9JRCIgXQogICAgICAgIHRoZW4KICAgICAgICAgICBzZXRfdmFsdWUgIm15c3FsZCIgInNlcnZlci1pZCIgIiRTTEFWRVNFUlZFUklEIgogICAgICAgIGVsc2UKICAgICAgICAgICBzZXRfdmFsdWUgIm15c3FsZCIgInNlcnZlci1pZCIgIiRNWVNRTF9TRVJWRVJfSUQiCiAgICAgICAgZmkKICAgICAgICBydW5fbXlzcWxfdGVtcF9iZwogICAgICAgIHNsZWVwIDUKICAgICAgICB3YWl0aW5nX2Zvcl9kYgogICAgIGZpCiAgICAgICAgICAgICAgCiAgICAgYWN0aXZhdGVfc2xhdmUKCiAgZWxzZQogICAgIGRpc3BsYXlfb3V0cHV0ICIke0dSRUVORk9OVH1SdW5uaW5nIERhdGFiYXNlICR7QkxVRUZPTlR9JE1ZU1FMX0RBVEFCQVNFX05BTUUiCiAgZmkKICAgICAKfQoKCndhaXRpbmdfZm9yX2RiKCkKewogICB3PTEKICAgd2hpbGUgW1sgIiQoaXNfbXlzcWxfYWNjZXNzaWJsZSAiJE1ZU1FMX1JPT1RfUEFTU1dPUkQiICkiID0gIk5PVCBSVU5OSU5HIiBdXQogICBkbwogICAgICBbWyAkdyAtZ3QgMTAgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1VbmFibGUgdG8gc3RhcnR1cCBNeVNRTCBTZXJ2ZXIuLi4uIiAmJiBleGl0IDEKICAgICAgZGlzcGxheV9vdXRwdXQgIiR7WUVMTE9XRk9OVH1XYWl0aW5nIGZvciBNeVNRTCBkYXRhYmFzZSB0byBiZSBhY2Nlc3NpYmxlICQoKCB3ICogNSApKSBvZiAkKCggMTAgKiA1ICkpIHNlY29uZHMiCiAgICAgIHNsZWVwIDUKICAgICAgdz0kKCggdyArIDEgKSkKICAgZG9uZQp9CgojTWFpbgoKcm0gLWYgJHtNWVNRTF9MT0dTX0RJUn0vbXlzcWxkLmxvZyA+L2Rldi9udWxsCltbICEgLUwgIiR7TVlTUUxfTE9HU19ESVJ9L215c3FsZC5sb2ciIF1dICYmIGxuIC1zZiAvZGV2L3N0ZG91dCAiJE1ZU1FMX0xPR1NfRElSIi9teXNxbGQubG9nICYmIHVzZXJtb2QgLWEgLUcgdHR5IG15c3FsICYmIGNob3duIG15c3FsOm15c3FsICIkTVlTUUxfTE9HU19ESVIiL215c3FsZC5sb2cKCmlmIFtbIC1mIC8uZG9ja2VyZW52ICYmICRVU0VfQ09OVEFJTkVSX0FERFJFU1MgIT0gInllcyIgXV0KdGhlbgogICBbWyAiJEdBTEVSQV9ERUZBVUxUX05PREVOQU1FIiA9ICIkKGhvc3RuYW1lIC1zKSIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1SdW5uaW5nIG9uIGRvY2tlciBjb250YWluZXIgR0FMRVJBX0RFRkFVTFRfTk9ERU5BTUUgbXVzdCBiZSBzZXQgdG8gaG9zdCBub2RlbmFtZSIgJiYgZXhpdAogICBbWyAiJEdBTEVSQV9ERUZBVUxUX0FERFJFU1MiID0gIiQoaG9zdG5hbWUgLWkgfCBhd2sgJ3twcmludCAkMX0nKSIgXV0gJiYgZGlzcGxheV9vdXRwdXQgIiR7UkVERk9OVH1SdW5uaW5nIG9uIGRvY2tlciBjb250YWluZXIgR0FMRVJBX0RFRkFVTFRfQUREUkVTUyBtdXN0IGJlIHNldCB0byBob3N0IElQIGFkZHJlc3MiICYmIGV4aXQKZWxzZQogICBbWyAiJEdBTEVSQV9ERUZBVUxUX05PREVOQU1FIiAhPSAiJChob3N0bmFtZSAtcykiIF1dICYmIGV4cG9ydCBHQUxFUkFfREVGQVVMVF9OT0RFTkFNRT0iJChob3N0bmFtZSAtcykiCiAgIFtbICIkR0FMRVJBX0RFRkFVTFRfQUREUkVTUyIgIT0gIiQoaG9zdG5hbWUgLWkgfCBhd2sgJ3twcmludCAkMX0nKSIgXV0gJiYgZXhwb3J0IEdBTEVSQV9ERUZBVUxUX0FERFJFU1M9IiQoaG9zdG5hbWUgLWkgfCBhd2sgJ3twcmludCAkMX0nKSIKZmkKCltbICIkR0FMRVJBX0NMVVNURVJfQUNUSVZFIiA9ICJ5ZXMiIF1dICYmIHJ1bl9jbHVzdGVyCmNyZWF0ZV9kZWZhdWx0X3BhcmFtZXRlcnMKCltbICEgLWQgJE1ZU1FMX0RBVEFCQVNFX0RJUiBdXSAmJiBta2RpciAtcCAiJE1ZU1FMX0RBVEFCQVNFX0RJUiIgCmNob3duICREQlVTRVI6JERCVVNFUiAiJE1ZU1FMX0RBVEFCQVNFX0RJUiIKCgppZiBbWyAhIC1kICIkTVlTUUxfREFUQUJBU0VfRElSL215c3FsIiB8fCAiJE1ZU1FMX0RBVEFCQVNFX1JFQlVJTEQiID0gInllcyIgXV0gJiYgW1sgIiRHQUxFUkFfQ0xVU1RFUl9BRERSRVNTIiA9ICJnY29tbTovLyIgXV0KdGhlbgogICBkaXNwbGF5X291dHB1dCAiJHtHUkVFTkZPTlR9Q2hlY2tpbmcgd2hldGhlciBNeVNRTCBTZXJ2ZXIgaXMgcnVubmluZy4uLiIKICAgW1sgJChpc19teXNxbF9ydW5uaW5nKSAtZXEgMCBdXSAmJiBraWxsIC05ICIkKGdldF9waWQgJE1ZU1FMX1BJRF9GSUxFICkiCiAgIAoKICAgaW5pdF9teXNxbF9kYXRhYmFzZQoKICAgZGlzcGxheV9vdXRwdXQgIiR7R1JFRU5GT05UfVN0YXJ0aW5nIHVwIE15U1FMIFNlcnZlciB0ZW1wb3JhcmlseS4uLiIKICAgcnVuX215c3FsX3RlbXBfYmcKICAgc2xlZXAgMTAKICAgd2FpdGluZ19mb3JfZGIKICAgY3JlYXRlX2RiX2FuZF91c2VyCiAgIGNyZWF0ZV9yZXBsX3VzZXIKICAgY3JlYXRlX2JhY2t1cF91c2VyCiAgIFtbICQoaXNfbXlzcWxfcnVubmluZykgLWVxIDAgXV0gJiYgc2h1dGRvd25fdG1wX215c3FsCiAgIFtbICEgLUwgIiR7TVlTUUxfTE9HU19ESVJ9L215c3FsZC5sb2ciIF1dICYmIHJtIC1mICIkTVlTUUxfTE9HU19ESVIiL215c3FsZC5sb2cKZWxzZQogICBydW5fbXlzcWxfdGVtcF9iZyAgIAogICBzbGVlcCAxMAogICB3YWl0aW5nX2Zvcl9kYgogICAgICAKZmkKCltbICEgLUwgIiR7TVlTUUxfTE9HU19ESVJ9L215c3FsZC5sb2ciIF1dICYmIGxuIC1zZiAvZGV2L3N0ZG91dCAiJE1ZU1FMX0xPR1NfRElSIi9teXNxbGQubG9nICYmIHVzZXJtb2QgLWEgLUcgdHR5IG15c3FsICYmIGNob3duIC1oIG15c3FsOm15c3FsICIkTVlTUUxfTE9HU19ESVIiL215c3FsZC5sb2cKCmlmIFsgIiRNWVNRTF9SRVBMSUNBX1NMQVZFIiA9ICJ5ZXMiIF0KdGhlbgogICBydW5fc2xhdmUKZWxzZQogICBteXNxbGQgLS11c2VyICREQlVTRVIgLS1sb2ctZXJyb3ItdmVyYm9zaXR5PTMgJFdTUkVQTkVXQ0xVU1RFUgpmaQo=" | base64 -d > /usr/local/bin/entrypoint-gmysql8.sh && chmod ugo+x /usr/local/bin/entrypoint-gmysql8.sh
ENTRYPOINT ["/usr/local/bin/entrypoint-gmysql8.sh"]
